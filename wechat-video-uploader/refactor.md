# 视频上传系统重构计划

## 1. 代码结构重组

### 1.1 通用功能模块 (`upload_common.js`)

将以下通用功能迁移到 `upload_common.js`：

1. 基础设置和工具函数：
   - 环境变量加载
   - 应用根目录确定
   - 延时函数
   - Cookie 管理（保存/加载）
   - MP4文件获取
   - 命令行参数处理

2. 通用浏览器操作：
   - 浏览器实例创建
   - 登录状态检查
   - 等待用户输入

### 1.2 平台特定模块

1. `upload_weixin.js`：
   - 微信视频号特定的上传流程
   - 平台特定的页面操作
   - 特定的登录检查逻辑

2. `upload_rednote.js`：
   - 小红书特定的上传流程
   - 平台特定的页面操作
   - 特定的登录检查逻辑

3. `upload_kuaishou.js`：
   - 快手特定的上传流程
   - 平台特定的页面操作
   - 特定的登录检查逻辑

### 1.3 主入口模块 (`upload_main.js`)

1. 命令行参数扩展：
   ```
   --platform <platform>  # 指定上传平台（weixin/rednote/kuaishou）
   --dir <directory>     # 视频目录
   --headless           # 无界面模式
   --collection <name>  # 合集名称
   ```

2. 根据平台参数调用对应的上传模块

## 2. 重构步骤

1. 创建 `upload_common.js`：
   - 提取现有 `upload_main.js` 中的通用功能
   - 确保所有平台都能复用这些功能

2. 重构 `upload_weixin.js`：
   - 将现有的微信视频号上传逻辑迁移到这个文件
   - 只保留平台特定的操作

3. 创建 `upload_rednote.js` 和 `upload_kuaishou.js`：
   - 参考微信视频号的实现
   - 实现各自平台的特定上传流程

4. 重构 `upload_main.js`：
   - 简化为平台选择和调用的入口
   - 统一的参数处理
   - 错误处理和日志记录

## 3. 注意事项

1. 保持现有功能完整性：
   - 确保微信视频号上传功能不受影响
   - 维持现有的配置项和环境变量

2. 代码质量：
   - 保持一致的错误处理方式
   - 添加必要的日志记录
   - 保持代码风格统一

3. 配置管理：
   - 各平台的配置项统一管理
   - 环境变量命名规范化

## 4. 后续扩展

1. 支持更多平台：
   - 代码结构便于添加新平台
   - 统一的接口约定

2. 功能增强：
   - 支持批量上传
   - 上传状态记录
   - 失败重试机制
